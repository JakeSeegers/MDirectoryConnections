// --- U-M THEME CONSTANTS ---
const UM_BLUE = '#00274C';
const UM_MAIZE = '#FFCB05';
const UM_BLUE_LIGHT = '#B0D0DB';
const UM_TEXT_ON_MAIZE = '#00274C'; // Text color for maize backgrounds

// --- ABBREVIATIONS & TAG RULES ---
const abbreviationMap = { 
    // Room/Space Abbreviations
    "JanClos": "Janitorial Closet", "CleanRm": "Clean Room", "MaintRm": "Maintenance Room", "ExamRm": "Examination Room", "ProcedRm": "Procedure Room", "TrainingRm": "Training Room", "TestRm": "Testing Room", "AnteRm": "Anteroom", "ScrubRm": "Scrub Room", "CallRm": "Call Room", "TubRm": "Tub Room", "ControlRm": "Control Room", "CopyRm": "Copy Room", "StaffRm": "Staff Room", "RecovryRm": "Recovery Room", "StaffLkrRm": "Staff Locker Room", "StrlzerRm": "Sterilizer Room", "StaffShowr": "Staff Shower", "FileRm": "File Room", "ObsrvtnRm": "Observation Room", "PatDress": "Patient Dressing Room", "PatPrep": "Patient Preparation Room", "LockerRm": "Locker Room", "TeamngArea": "Teaming Area", "PatnLounge": "Patient Lounge", "DptLounge": "Department Lounge", "ParntSleep": "Parent Sleep Area", "ParntShwr": "Parent Shower", "NurishmtRm": "Nourishment Room", "PatnKitchn": "Patient Kitchen", "RecepArea": "Reception Area", "OpenWkSta": "Open Workstation", "FlxOpnWkSt": "Flexible Open Workstation", "FlexCubicl": "Flexible Cubicle", "FlexOffice": "Flexible Office", "CompSuppt": "Computer Support", "ReceptWtg": "Reception Waiting", "ReceptClrk": "Reception Clerk", "LobbyVest": "Lobby Vestibule", "MedSupply": "Medical Supply", "PharSupply": "Pharmacy Supply", "SterileStg": "Sterile Storage", "MedGasStrg": "Medical Gas Storage", "VndgWOStg": "Vending with Storage", "SoiledLin": "Soiled Linen", "ClnLin": "Clean Linen", "StrlSoiled": "Sterile Soiled", "StrlStrg": "Sterile Storage", "SupplyRm": "Supply Room", "StorageRm": "Storage Room", "StockRm": "Stock Room", "DptStorage": "Department Storage", "EqmtStrgRm": "Equipment Storage Room", "SuplStgRm": "Supply Storage Room", "ImEquipSup": "Imaging Equipment Supply", "StrlInsSup": "Sterile Instrument Supply", "SrgySupEqm": "Surgery Supply Equipment", "ClnLnMdSup": "Clean Linen Medical Supply", "ClnLin/MdS": "Clean Linen/Medical Supply", "SoiLinSupl": "Soiled Linen Supply", "CServSupp": "Central Service Support", "CentralSup": "Central Supply", "DiagLabSup": "Diagnostic Lab Supply", "DiagTrtmt": "Diagnostic Treatment", "TherTrtmt": "Therapy Treatment", "SurgerySvc": "Surgery Service", "HazardMat": "Hazardous Materials", "AssignCir": "Assigned Circulation", "AssignCirc": "Assigned Circulation", "ExtendStay": "Extended Stay", "InPatnt": "Inpatient", "OutPtToilt": "Outpatient Toilet", "PreOpPtPre": "Pre-Op Patient Prep", "FoodFacSvc": "Food Facility Service", "FoodStPrep": "Food Service Preparation", "Circulat'n": "Circulation", "PublicWait": "Public Waiting", "PubCorr": "Public Corridor", "AsgnToilet": "Assigned Toilet", "StffToilet": "Staff Toilet", "OutPtClsRm": "Outpatient Closet Room", "PubRestRm": "Public Restroom", "AlGnHandic": "All Gender Handicap", "AlGnRestRm": "All Gender Restroom", "Men-Handic": "Men's Handicap", "Wmn-Handic": "Women's Handicap", "DptBreak": "Department Break Room", "DptKitchen": "Department Kitchen", "DptMail": "Department Mail", "Treat/Exam": "Treatment/Examination", "Tr/ExamSvc": "Treatment/Examination Service", "ExamSvc": "Examination Service", "PatienBdrm": "Patient Bedroom", "PatientBth": "Patient Bathroom", "InPatnBth": "In Patient Bathroom", "PatBedSvc": "Patient Bed Service", "NurseStnSr": "Nurse Station Service", "Nurse Stat": "Nurse's Station", "StaffOnCal": "Staff On Call", "StfOnCallS": "Staff On Call Service", "AssemblySv": "Assembly Service", "MerchSvc": "Merchandise Service", "merchandsg": "Merchandising", "MedProdSvc": "Medical Product Service", "RadCT": "Radiology CT", "RadIR": "Radiology Interventional", "RadMRI": "Radiology MRI", "RadNucMed": "Radiology Nuclear Medicine", "RadUltrasd": "Radiology Ultrasound", "RadXRay": "Radiology X-Ray", "DiagSrvLab": "Diagnostic Service Laboratory", "IsotopeRm": "Isotope Room", "FilmPrView": "Film Preview", "BldDrawSta": "Blood Draw Station", "ProsthShop": "Prosthetics Shop", "PhotogSvc": "Photography Service", "ChartFFRm": "Charting/Forms/Files Room", "Decontamin": "Decontamination", "PrepStgRm": "Preparation Staging Room", "ConsultRm": "Consultation Room", "PsychPtIso": "Psychiatric Patient Isolation", "InPatnICU": "Inpatient ICU", "InPatnIso": "Inpatient Isolation", "InPatnPsyc": "Inpatient Psychiatric", "LbrDeliIso": "Labor Delivery Isolation", "LbrDeliv": "Labor Delivery", "NeoICU": "Neonatal ICU", "NeoICUIso": "Neonatal ICU Isolation", "PedInPtPsy": "Pediatric Inpatient Psychiatric", "PedsICU": "Pediatric ICU", "AcThTrtRm": "Acute Therapy Treatment Room", "InPatClsRm": "Inpatient Classroom", "ActPlayRm": "Activity/Play Room", "PatFamAmen": "Patient Family Amenities", "HseOfcrOnC": "House Officer On Call", "MedStuOnC": "Medical Student On Call", "On-CallRm": "On-Call Room", "OnCallClst": "On Call Closet", "OnCallLnge": "On Call Lounge", "OnCllBthrm": "On Call Bathroom", "Ctrl/Obsrv": "Control/Observation", "HVAC": "Heating, Ventilation, and Air Conditioning", "ElectEquip": "Electrical Equipment", "MechEquip": "Mechanical Equipment", "VertShaft": "Vertical Shaft", "Comm": "Communications", "Off.": "Office", "Off": "Office", "Mech.": "Mechanical", "Mech": "Mechanical", "Admin.": "Administration", "Admin": "Administration", "Lab.": "Laboratory", "Lab": "Laboratory", "Stor.": "Storage", "Stor": "Storage", "WC": "Bathroom", "Restroom": "Bathroom", "Corr.": "Corridor", "Corr": "Corridor", "MM CW - Facilities Maintenance": "CW - Facilities Maintenance", "MM - ECT Nursing Services": "ECT Nursing Services", "MM Matl Mgmt - Warehouse Ops": "Material Management - Warehouse Operations", "MM CW Ped Cardiology - Tech": "CW Pediatrics Cardiology - Technical", "MM Nsg Clin Support CSR": "Nursing Clinical Support Clinical Support Representative", "MM UMMG NonACU Prof - Derm.": "UMMG Non-Acute Care Unit Professional - Dermatology", "MM UMMG NonACU Prof - Orthopae": "UMMG Non-Acute Care Unit Professional - Orthopaedics", "MM CW 8W": "CW 8 West", "MM CW Mott Administration": "CW Mott Administration", "MM CW Ped Surgery Admin": "CW Pediatrics Surgery Administration", "MM CW Social Work - Pediatric": "CW Social Work - Pediatric", "MM UMMG NonACU Prof - Radiatio": "UMMG Non-Acute Care Unit Professional - Radiation Oncology", "MM Nsg OH CNE": "Nursing Occupational Health Clinical Nurse Educator", "MM CW Pediatric Audiology": "CW Pediatric Audiology", "MM CW Fetal Diagnostic Center": "CW Fetal Diagnostic Center", "MM CW Neuro/Oral/Plastic Surg": "CW Neurology/Oral/Plastic Surgery", "MM Quality - Infection Prevent": "Quality - Infection Prevention", "MM Peds Administration": "Pediatrics Administration", "MM DLHS Administration": "Department of Learning Health Sciences Administration", "MM CW Childrens Emergency Svc": "CW Childrens Emergency Service", "MM Chief of Clinical Affairs": "Chief of Clinical Affairs", "MM OH Care Mgt Admin": "Occupational Health Care Management Administration", "MM UMMG NonACU Prof - Infectio": "UMMG Non-Acute Care Unit Professional - Infectious Diseases", "MM CW Ped Multi - Spec FL6": "CW Pediatrics Multi - Specialty Floor 6", "MM Maintenance": "Maintenance", "MM CW Oper Room - Mott": "CW Operating Room - Mott", "MM Neurology IOM": "Neurology Intraoperative Neurophysiological Monitoring", "MM Admin - Anesthesia": "Administration - Anesthesia", "MM Vestiblr Test - Tech": "Vestibular Test - Technical", "MM CW Pediatric Ortho Clinic": "CW Pediatric Orthopaedic Clinic", "MM Surg/Necropsy Path": "Surgery/Necropsy Pathology", "MM Psych Emergency Svc": "Psychiatry Emergency Service", "MM Logistics Patient Transport": "Logistics Patient Transport", "MM CW Peds Infusion": "CW Pediatrics Infusion", "MM CW Post Anes Care Unit-Mott": "CW Post Anesthesia Care Unit-Mott", "MM UMMG NonACU Prof - Ped Surg": "UMMG Non-Acute Care Unit Professional - Pediatric Surgery", "MM CW Urology Clinic LVL 4": "CW Urology Clinic Level 4", "MM Psych Chair s Office": "Psychiatry Chair's Office", "MM Hosp/Med School Interunit": "Hospital/Medical School Interunit", "MM Medical School Administratn": "Medical School Administration", "MM TC Administration": "Transplant Center Administration", "MM Oral Surg Med Inn Clinic": "Oral Surgery Medical Inn Clinic", "MM CW Photophersis Center": "CW Photopheresis Center", "MM CW OB/GYN Clinic Tech": "CW Obstetrics/Gynecology Clinic Technical", "MM Nsg Clin Support SWAT": "Nursing Clinical Support SWAT", "MM CW-Triage Midwives": "CW-Triage Midwives", "MM Cardiac Cath Lab Tech": "Cardiac Catheterization Laboratory Technical", "MM Med Proc Unit - Tech": "Medical Procedure Unit - Technical", "MM CVC - Diagnostic Vascular": "Cardiovascular Center - Diagnostic Vascular", "MM Clinical Lab Admin": "Clinical Laboratory Administration", "MM Pat and Fam Support Svc": "Patient and Family Support Service", "MM Int Med Fac Hospitalists": "Internal Medicine Faculty Hospitalists", "MM CW Mott Resp Therapy": "CW Mott Respiratory Therapy", "MM Acute Hemodialysis": "Acute Hemodialysis", "MM CW Hemophilia/COAG CMS": "CW Hemophilia/Coagulation CMS", "MM Cancer Center Admin": "Cancer Center Administration", "MM Cardiology Admin": "Cardiology Administration", "MM HomeMed Pharmacy Infusion": "HomeMed Pharmacy Infusion", "MM CVC Clinic": "Cardiovascular Center Clinic", "MM Psych Split Fund": "Psychiatry Split Fund", "MM OH Care Mgt": "Occupational Health Care Management", "MM Med Inn Sleep Clinic": "Medical Inn Sleep Clinic", "MM CPU Central/Recovery": "Cardiac Procedure Unit Central/Recovery", "MM Pathology Blood Bank": "Pathology Blood Bank", "MM Interventnl Nephrology Unit": "Interventional Nephrology Unit", "MM Safety Management Services": "Safety Management Services", "MM Infusion Cancer Center": "Infusion Cancer Center", "MM Entrance Services": "Entrance Services", "MM Blue Cancer Center": "Blue Cancer Center", "MM Sleep Laboratory": "Sleep Laboratory", "MM CW Pediatric OTO Clinic": "CW Pediatric Otolaryngology Clinic", "MM Psych Adult I/P": "Psychiatry Adult Inpatient", "MM Urology": "Urology", "MM Noncapital Infrastructure": "Noncapital Infrastructure", "MM Dermatology-Tech": "Dermatology-Technical", "MM Nsg OH Prof Dev and Ed": "Nursing Occupational Health Professional Development and Education", "MM Gold Cancer Center": "Gold Cancer Center", "MM Pharmacy Administration": "Pharmacy Administration", "MM Contract Services Programs": "Contract Services Programs", "MM Radiology UH": "Radiology University Hospital", "MM Thyroid Clinic RAD": "Thyroid Clinic Radiology", "MM CW Path O/P Phlebotomy": "CW Pathology Outpatient Phlebotomy", "MM Research-Clin Trial Units": "Research-Clinical Trial Units", "MM UMMG NonACU Prof - Neurolog": "UMMG Non-Acute Care Unit Professional - Neurology", "MM Otolaryngology - HNS": "Otolaryngology - Head and Neck Surgery", "MM Molec & Integratv Physiolog": "Molecular and Integrative Physiology", "MM Path Reference Tests": "Pathology Reference Tests", "MM GSA - Veterans Affairs(VAH)": "GSA - Veterans Affairs(VAH)", "MM Revenue Cycle Administrtn": "Revenue Cycle Administration", "MM Environmental Svcs - Admin": "Environmental Services - Administration", "MM Necropsy Suite/Medicolegal": "Necropsy Suite/Medicolegal", "MM Inpatient Pharmacy Svcs": "Inpatient Pharmacy Services", "MM Ctr fr Translational Path.": "Center for Translational Pathology", "MM GSA - Administrtn (GSA/ADM)": "GSA - Administration (GSA/ADM)", "MM Maize Cancer Center": "Maize Cancer Center", "MM HITS FA Fin Ops & Analysis": "Health Information Technology & Services Financial Analysis Financial Operations & Analysis", "MM Howard Hughes Med Institute": "Howard Hughes Medical Institute", "MM CW Adult BMT & Leuke. Infus": "CW Adult Bone Marrow Transplant and Leukemia Infusion", "MM Med Inn Admin": "Medical Inn Administration", "MM UMMG NonACU Prof - Plastic": "UMMG Non-Acute Care Unit Professional - Plastic Surgery", "MM CW Peds Pulmonary Function": "CW Pediatrics Pulmonary Function", "MM Peds Acute Care Therapy": "Pediatrics Acute Care Therapy", "MM UMMG NonACU Prof - Cardiolo": "UMMG Non-Acute Care Unit Professional - Cardiology", "MM Hem Onc Phys Ext - Prof": "Hematology Oncology Physician Extender - Professional", "MM Orthotics&Prosthetics Ctr": "Orthotics and Prosthetics Center", "MM Building Utilities": "Building Utilities", "MM Pathology Informatics": "Pathology Informatics", "MM CW Peds Speech-Lang Path": "CW Pediatrics Speech-Language Pathology", "MM MSA Institutnl Commit & Adj": "Medical School Administration Institutional Committee & Adjudication", "MM Int Med-Hematology/Oncology": "Internal Medicine-Hematology/Oncology", "MM Investigations": "Investigations", "MM Oper Rooms - Univ Hospital": "Operating Rooms - University Hospital", "MM CW Adult BMT & Leuke. Clin": "CW Adult Bone Marrow Transplant and Leukemia Clinic", "MM UH CVC 8D": "University Hospital Cardiovascular Center 8D", "MM UMMG NonACU Prof - Neurosur": "UMMG Non-Acute Care Unit Professional - Neurosurgery", "MM Transfusion/Apheresis": "Transfusion/Apheresis", "MM Gen Surg Clinic - Tech": "General Surgery Clinic - Technical", "MM UH CVC Med Short Stay": "University Hospital Cardiovascular Center Medical Short Stay", "MM Anesthesia UH": "Anesthesia University Hospital", "MM Speech Pathology": "Speech Pathology", "MM Lab Animal Medicine Unit": "Laboratory Animal Medicine Unit", "MM CW - Non-Cancer Infusion": "CW - Non-Cancer Infusion", "MM Adult I/P Social Work": "Adult Inpatient Social Work", "MM UH/CVC Executive Director": "University Hospital/Cardiovascular Center Executive Director", "MM Facilities": "Facilities", "MM Radiation Oncology - AA": "Radiation Oncology - Ann Arbor", "MM Centralized Scope Process.": "Centralized Scope Processing", "MM Friends Gift Sh-Oper": "Friends Gift Shop-Operations", "MM CVC Rad": "Cardiovascular Center Radiology", "MM UH CVC Nsg Surg Admin": "University Hospital Cardiovascular Center Nursing Surgery Administration", "MM Pm&R Rehab Engr": "Physical Medicine & Rehabilitation Rehab Engineering", "MM Pulmonary Lab Tech": "Pulmonary Laboratory Technical", "MM UH CVC CVC4": "University Hospital Cardiovascular Center CVC4", "MM Gold Cancer Center RAD": "Gold Cancer Center Radiology", "MM UH CVC 4B": "University Hospital Cardiovascular Center 4B", "MM CW Cardiac Surg OR/FI Cover": "CW Cardiac Surgery Operating Room/Fixed Imaging Coverage", "MM UH CVC 4A": "University Hospital Cardiovascular Center 4A", "MM UH CVC 4C": "University Hospital Cardiovascular Center 4C", "MM UH CVC 5A": "University Hospital Cardiovascular Center 5A", "MM UH CVC 7A-1": "University Hospital Cardiovascular Center 7A-1", "MM UH CVC 6D": "University Hospital Cardiovascular Center 6D", "MM UH CVC CVC5-ICU": "University Hospital Cardiovascular Center CVC5-Intensive Care Unit", "MM UH CVC 6B1": "University Hospital Cardiovascular Center 6B1", "MM UH CVC CVC5": "University Hospital Cardiovascular Center CVC5", "MM UH CVC 7B": "University Hospital Cardiovascular Center 7B", "MM UH CVC 5B1": "University Hospital Cardiovascular Center 5B1", "MM UH CVC 7C": "University Hospital Cardiovascular Center 7C", "MM UH CVC 5C": "University Hospital Cardiovascular Center 5C", "MM UH CVC 7D": "University Hospital Cardiovascular Center 7D", "MM UH CVC 5D": "University Hospital Cardiovascular Center 5D", "MM UH CVC 8A2": "University Hospital Cardiovascular Center 8A2", "MM UH CVC 8B2": "University Hospital Cardiovascular Center 8B2", "MM UH CVC 8C": "University Hospital Cardiovascular Center 8C", "MM UH CVC 9C": "University Hospital Cardiovascular Center 9C", "MM Diag Vascular - Tech": "Diagnostic Vascular - Technical", "MM Path O/P - Phleb Taubman": "Pathology Outpatient - Phlebotomy Taubman", "MM CW PM&R Rehab Engr": "CW Physical Medicine & Rehabilitation Rehab Engineering", "MM Echocardio Technical": "Echocardiography Technical", "MM Pediatric Hematology Oncolo": "Pediatric Hematology Oncology", "MM Surgery Department": "Surgery Department", "MM Urology Clinic - Tech": "Urology Clinic - Technical", "MM DLHS Clin. Simulation Ctr": "Department of Learning Health Sciences Clinical Simulation Center", "MM Pm&R Emg": "Physical Medicine & Rehabilitation Electromyography", "MM GSA - Gastrointestinal(SGI)": "GSA - Gastrointestinal(SGI)", "MM Neurology Stroke Program": "Neurology Stroke Program", "MM GSA - Surg Oncology (SON)": "GSA - Surgery Oncology (SON)", "MM Frankel CVC Administration": "Frankel Cardiovascular Center Administration", "MM Operations and Ancill Svcs": "Operations and Ancillary Services", "MM Oral & Maxillofacial Surg": "Oral and Maxillofacial Surgery", "MM Int Med-Genetic Medicine": "Internal Medicine-Genetic Medicine", "MM Clinical Engineering Svcs": "Clinical Engineering Services", "MM Clinical Engineering": "Clinical Engineering", "MM Int Med Admin/Overhead": "Internal Medicine Administration/Overhead", "MM Gifts of Art": "Gifts of Art", "MM Revenue Cycle Mid-Service": "Revenue Cycle Mid-Service", "MM Parking Support": "Parking Support", "MM Reg & Ins Verification": "Registration & Insurance Verification", "MM Dermatology Department": "Dermatology Department", "MM Resp/Cardiov Svcs": "Respiratory/Cardiovascular Services", "MM Supply Chain Admin": "Supply Chain Administration", "MM O-CTSU Stdy Coordinatr Clin": "Oncology Clinical Trials Support Unit Study Coordinator Clinical", "MM Pathology Department": "Pathology Department", "MM Ob-Gyn Admin.": "Obstetrics-Gynecology Administration", "MM UHCVC Security Svcs": "University Hospital Cardiovascular Center Security Services", "MM Construction Svcs Admin": "Construction Services Administration", "MM Int Med-Gastroenterology": "Internal Medicine-Gastroenterology", "MM Interpreters Program": "Interpreters Program", "MM Social Work Guest Prog": "Social Work Guest Program", "MM PAR Management": "Patient Access/Registration Management", "Institutional Org": "Institutional Organization", "MM CW VVWH": "CW Von Voigtlander Women's Hospital", "MM Patient Experience": "Patient Experience", "MM UH CVC 6C": "University Hospital Cardiovascular Center 6C", "MM-Adult Palliative Care": "Adult Palliative Care", "MM-CVC ACU Rad": "Cardiovascular Center Acute Care Unit Radiology", "MM Ekogram Technical": "Echocardiogram Technical",
};

const fullReplacements = { "Circulation Public Corridor": "Corridor", "Circulation Lobby Vestibule": "Lobby", "Circulation Stair": "Stairwell", "Circulation Elevator": "Elevator", "Circulation Dock": "Loading Dock", "Public Toilet Uni-Sex": "Unisex Public Bathroom", "Public Toilet Men": "Men's Public Bathroom", "Public Toilet Women": "Women's Public Bathroom", "OutPtToilt": "Public Bathroom", "Mechanical Electrical Equipment": "Electrical Room", "Mechanical Mechanical Equipment": "Mechanical Room", "Mechanical HVAC": "HVAC Room", "Mechanical Vertical Shaft": "Vertical Shaft", "Mechanical Communications": "Communications Room", "HazardMat HazardMat": "Hazardous Materials Storage", "Conference Conference": "Conference Room", "Office Office": "Office", "Surgery Operating": "Operating Room" };

const tagRules = [ { pattern: /patient|bed|family/i, tag: "patient-care" }, { pattern: /office|admin|conference|meeting|lounge/i, tag: "administration" }, { pattern: /exam|treatment|therapy|medical|nurse|clinic|surgery|operating/i, tag: "clinical" }, { pattern: /toilet|bathroom|shower|restroom|wc/i, tag: "restroom" }, { pattern: /outpatient toilet|public toilet|pub.*restroom/i, tag: "public-restroom" }, { pattern: /storage|supply|equipment|closet/i, tag: "storage" }, { pattern: /mechanical|electrical|maintenance|hvac|communications/i, tag: "infrastructure" }, { pattern: /corridor|stair|elevator|lobby|circulation/i, tag: "circulation" }, { pattern: /kitchen|food|dining/i, tag: "food-service" }, { pattern: /laboratory|diagnostic|radiology|imaging/i, tag: "diagnostic" } ];